{% extends "global/Page.html" %}
{% load otree %}
{% block styles %}
<style type="text/css">
table.lap, td.lap, th.lap {
    border: 1px solid black;
  }
  
  table.lap {
    border-collapse: collapse;
    width: 100%;
    margin-top: 24px;
  }
  
  th.lap {
    font-size: 14px /*0.75vw*/;
    height: 2ex;
    text-align: center;
    background-color: rgb(200, 200, 200);
  }
  
  td.lap {
    font-size: 14px /*0.5vw*/;
    height: 3.5ex;
    text-align: left;
    padding: 24px;
  }
</style>
{% endblock %}
{% block title %}
    Lapor Pajak
{% endblock %}

{% block content %}
<p>Periode : {{round}}</p>

<input id="preview" type="button" class="btn btn-danger" onclick="prevFunction()" value="Preview Omset" />&emsp;&emsp;<span id="prev"></span>

<table class="lap">
    <tr><td class="lap">
    Pelaporan SPT
    <br>Periode : XXX
    <br><br>
    <input type="hidden" id="prefill_persen" name="prefill_persen" />
    <input type="hidden" id="omset_input" name="omset_input" />
    Masukkan omset&emsp;&emsp;&emsp;&emsp;: <input type="text" id="txt_omset_input" name="txt_omset_input" /> EU<br><br>
    Jumlah pajak terutang &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <input type="text" id="pph" name="pph" disabled /> EU
    <br><br>
    <input id="btnHitung" type="button" class="btn btn-success" onclick="hitungFunction()" value="Hitung" />
    <br>
    <input type="hidden" id="payoff_awal" name="payoff_awal" />
    Jumlah payoff yang mungkin didapat pada periode ini : <input type="text" id="txt_payoff_awal" name="txt_payoff_awal" disabled /> EU<br>
    </td></tr>
</table>
<br>
{% next_button %}
<script>

    function hitungFunction() {
      var txt_omset = document.getElementById("txt_omset_input").value;
      var omset_input = parseFloat(txt_omset.replace(/,/g, ''));
        // var omset_input = Number(document.getElementById("omset_input").value)
        var ts = omset_input * 5 / 1000;
        var lr = {{player.total_omset}} - {{player.total_biaya}};
        var payoff = lr - ts;

        document.getElementById("pph").value = thousands_separators(ts)
        document.getElementById("payoff_awal").value = payoff

        if (document.getElementById("txt_omset_input").value == "") {
          document.getElementById("omset_input").value = 0
        } else {
          document.getElementById("omset_input").value = omset_input
        }
        document.getElementById("txt_payoff_awal").value = thousands_separators(payoff)
    }

    function prevFunction() {
      document.getElementById("prev").textContent = thousands_separators({{player.total_omset}}) + " EU"
    }

    function thousands_separators(num)
    {
        var num_parts = num.toString().split(".");
        num_parts[0] = num_parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        return num_parts.join(".");
    }

    $("#txt_omset_input").keyup(function(event){
        //var oms = str(document.getElementById("omset_input").value).replace(",","")
        // When user select text in the document, also abort.
        var selection = window.getSelection().toString(); 
        if (selection !== '') {
            return; 
        }       
        // When the arrow keys are pressed, abort.
        if ($.inArray(event.keyCode, [38, 40, 37, 39]) !== -1) {
            return; 
        }       
        var $this = $(this);            
        // Get the value.
        var input = $this.val();            
        input = input.replace(/[\D\s\._\-]+/g, ""); 
        input = input?parseInt(input, 10):0; 
        $this.val(function () {
            return (input === 0)?"0":input.toLocaleString("en-US"); 
        });
        $("#btnHitung").click();
    });

    //prefilled
    function getRndInteger(min, max) {
      return Math.floor(Math.random() * (max - min)) + min;
    }
    var treatment = Number({{treatment}});
    var prefilled_persen = 0;
    if (treatment == 1) {
      prefilled_persen = getRndInteger(25,99);
    } else if (treatment == 2) {
      prefilled_persen = 100;
    } else if (treatment == 3) {
      prefilled_persen = getRndInteger(101,175);
    } else {
      prefilled_persen = 100;
    }

    document.getElementById("prefill_persen").value = prefilled_persen;
    document.getElementById("txt_omset_input").value = prefilled_persen / 100 * {{player.total_omset}};
    $("#txt_omset_input").keyup();

</script>
{% endblock %}